---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.astro';
import RelatedPosts from '../../components/RelatedPosts.astro';
import { getCollection } from 'astro:content';
import { createTagSlug } from '../../utils/tags';
import { calculateReadingTime, formatReadingTime } from '../../utils/readingTime';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const siteUrl = "https://shorelinewebsolutions.com";

// Calculate reading time from post content
const readingTime = calculateReadingTime(post.body);
const readingTimeText = formatReadingTime(readingTime);

// Generate meta description from post content if not provided
// Take first 155 characters of content, removing markdown
const getPostDescription = () => {
	if (post.data.description) {
		return post.data.description;
	}
	// Extract first paragraph from content, remove markdown, limit to 155 chars
	const contentText = post.body.replace(/[#*\[\]()]/g, '').replace(/\n+/g, ' ').trim();
	const firstParagraph = contentText.split('.')[0] || contentText;
	return firstParagraph.substring(0, 155).trim() + (firstParagraph.length > 155 ? '...' : '');
};

const postDescription = getPostDescription();
const postOgImage = post.data.image ? `${siteUrl}${post.data.image}` : `${siteUrl}/og-image.jpg`;
---

<Layout 
	title={`${post.data.title} - Shoreline Web Solutions Blog`}
	description={postDescription}
	canonical={`/blog/${post.slug}`}
	ogImage={postOgImage}
	ogType="article"
>
	<!-- Breadcrumb Structured Data -->
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "BreadcrumbList",
		"itemListElement": [
			{
				"@type": "ListItem",
				"position": 1,
				"name": "Home",
				"item": `${siteUrl}/`
			},
			{
				"@type": "ListItem",
				"position": 2,
				"name": "Blog",
				"item": `${siteUrl}/blog`
			},
			{
				"@type": "ListItem",
				"position": 3,
				"name": post.data.title,
				"item": `${siteUrl}/blog/${post.slug}`
			}
		]
	})} />
	
	<!-- Blog Post Structured Data (Article Schema) -->
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "BlogPosting",
		"headline": post.data.title,
		"author": {
			"@type": "Person",
			"name": post.data.author
		},
		"datePublished": post.data.date,
		"dateModified": post.data.dateModified || post.data.date,
		"image": post.data.image ? `${siteUrl}${post.data.image}` : `${siteUrl}/og-image.jpg`,
		"publisher": {
			"@type": "Organization",
			"name": "Shoreline Web Solutions",
			"logo": {
				"@type": "ImageObject",
				"url": `${siteUrl}/favicon.svg`
			}
		},
		"mainEntityOfPage": {
			"@type": "WebPage",
			"@id": `${siteUrl}/blog/${post.slug}`
		}
	})} />
	<main>
		<!-- Navigation -->
		<Navigation currentPage="blog" />

		<!-- Article Header -->
		<article class="relative pt-20 pb-24 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 overflow-hidden">
			<!-- Background Elements -->
			<div class="absolute inset-0">
				<div class="absolute top-20 left-10 w-72 h-72 bg-blue-500/10 rounded-full blur-3xl"></div>
				<div class="absolute bottom-20 right-10 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl"></div>
				<div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-indigo-500/5 rounded-full blur-2xl"></div>
			</div>
			
			<div class="relative max-w-5xl mx-auto px-6">
				<!-- Breadcrumb -->
				<nav class="mb-10">
					<a href="/blog" class="group inline-flex items-center text-blue-300 hover:text-white transition-all duration-300">
						<svg class="w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
						</svg>
						<span class="font-medium">Back to Blog</span>
					</a>
				</nav>

				<!-- Article Title -->
				<h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-8 leading-tight">
					{post.data.title}
				</h1>

				<!-- Article Meta Info -->
				<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6 mb-10">
					<div class="flex items-center space-x-6 text-blue-200">
						<div class="flex items-center">
							<div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
								{post.data.author.charAt(0)}
							</div>
							<div>
								<span class="font-semibold text-white">By {post.data.author}</span>
								<div class="text-sm text-blue-300">Author</div>
							</div>
						</div>
						<div class="flex items-center">
							<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
							</svg>
							<div>
								<time datetime={post.data.date} class="font-semibold text-white">
									{new Date(post.data.date).toLocaleDateString('en-US', {
										year: 'numeric',
										month: 'long',
										day: 'numeric'
									})}
								</time>
								<div class="text-sm text-blue-300">Published</div>
							</div>
						</div>
					</div>
					
					<!-- Reading Time Estimate -->
					<div class="flex items-center text-blue-200">
						<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
							<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
						</svg>
						<span class="font-semibold text-white">{readingTimeText}</span>
					</div>
				</div>

				<!-- Article Image -->
				{post.data.image && (
					<div class="mb-10">
						<img 
							src={post.data.image} 
							alt={`Featured image for ${post.data.title} - ${post.data.author}'s article on web development and digital marketing`}
							class="w-full max-w-3xl mx-auto h-auto rounded-lg shadow-lg"
							loading="eager"
						/>
					</div>
				)}

			</div>
		</article>

		<!-- Article Content -->
		<section class="py-20 bg-gradient-to-b from-gray-50 to-white">
			<div class="max-w-5xl mx-auto px-6">
				<div class="grid grid-cols-1 lg:grid-cols-4 gap-12">
					<!-- Main Content -->
					<div class="lg:col-span-3">
            <div class="blog-content max-w-none" data-astro-cid-4sn4zg3r>
                <Content />
            </div>
						
						<!-- Article Tags -->
						<div class="mt-12 pt-8 border-t border-gray-200">
							<div class="flex flex-wrap gap-3">
								<span class="text-sm font-medium text-gray-600 mb-3 w-full">Tags:</span>
								{post.data.tags.map((tag) => (
									<a 
										href={`/blog/tag/${createTagSlug(tag)}`}
										class="px-4 py-2 bg-gradient-to-r from-blue-50 to-cyan-50 text-blue-700 text-sm font-semibold rounded-full border border-blue-200 hover:bg-gradient-to-r hover:from-blue-100 hover:to-cyan-100 hover:border-blue-300 transition-all duration-300 hover:scale-105 hover:shadow-md"
									>
										{tag}
									</a>
								))}
							</div>
						</div>
						
						<!-- Related Posts -->
						<div class="mt-12">
							<RelatedPosts currentPost={post} limit={3} showTags={true} />
						</div>
					</div>
					
					<!-- Sidebar -->
					<div class="lg:col-span-1">
						<div class="sticky top-8 space-y-8">
							<!-- Author Card -->
							<div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-6 border border-blue-100">
								<div class="flex items-center mb-4">
									<div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4">
										{post.data.author.charAt(0)}
									</div>
									<div>
										<h4 class="font-bold text-gray-900">{post.data.author}</h4>
										<p class="text-sm text-gray-600">Web Developer</p>
									</div>
								</div>
								<p class="text-sm text-gray-700 leading-relaxed">
									Web developer helping businesses grow online with professional websites and web applications.
								</p>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- CTA Section -->
		<section class="py-20 bg-gradient-to-br from-blue-700 to-cyan-700">
			<div class="max-w-4xl mx-auto text-center px-6">
				<div class="cta-content">
					<h2 class="text-4xl md:text-5xl font-bold text-white mb-6">
						Ready to Elevate Your Web Presence?
					</h2>
					<p class="text-xl text-blue-200 mb-8 leading-relaxed">
						Let's discuss how we can help bring your vision to life with a website that truly represents your business.
					</p>
					<div class="flex flex-col sm:flex-row gap-4 justify-center">
						<a href="/contact" 
							class="magnetic-button px-8 py-4 bg-white text-slate-900 font-semibold rounded-lg hover:bg-blue-50 transition-all duration-300 hover:scale-105 shadow-lg">
							Start Your Project
						</a>
						<a href="/blog" 
							class="magnetic-button px-8 py-4 bg-white text-slate-900 font-semibold rounded-lg hover:bg-blue-50 transition-all duration-300 hover:scale-105 shadow-lg">
							See More Posts
						</a>
					</div>
				</div>
			</div>
		</section>
	</main>
</Layout>

<style>
	/* Clean, professional prose styles for markdown content */
	.blog-content {
		color: #374151;
		line-height: 1.75;
		font-size: 1.125rem;
		max-width: 100%;
	}

	/* Headings - clean and readable */
	.blog-content h1 {
		color: #1e293b;
		font-size: 2.5rem;
		font-weight: 800;
		margin: 3rem 0 1.5rem 0;
		line-height: 1.2;
		border-bottom: 3px solid #3b82f6;
		padding-bottom: 0.75rem;
	}

	.blog-content h2 {
		color: #1e40af;
		font-size: 2rem;
		font-weight: 700;
		margin: 2.5rem 0 1.25rem 0;
		line-height: 1.3;
	}

	.blog-content h3 {
		color: #2563eb;
		font-size: 1.5rem;
		font-weight: 600;
		margin: 2rem 0 1rem 0;
		line-height: 1.4;
	}

	.blog-content h4 {
		color: #1e40af;
		font-size: 1.25rem;
		font-weight: 600;
		margin: 1.5rem 0 0.75rem 0;
		line-height: 1.5;
	}

	.blog-content h5 {
		color: #475569;
		font-size: 1.125rem;
		font-weight: 600;
		margin: 1.25rem 0 0.5rem 0;
	}

	.blog-content h6 {
		color: #64748b;
		font-size: 1rem;
		font-weight: 600;
		margin: 1rem 0 0.5rem 0;
	}

	/* Paragraphs */
	.blog-content p {
		margin-bottom: 1.5rem;
		color: #374151;
		font-size: 1.125rem;
		line-height: 1.75;
	}

	/* Lists - proper styling with explicit display */
	.blog-content ul,
	.blog-content ol {
		margin: 1.5rem 0 !important;
		padding-left: 2rem !important;
		display: block !important;
		list-style-position: outside !important;
	}

	.blog-content ul {
		list-style-type: disc !important;
	}

	.blog-content ol {
		list-style-type: decimal !important;
	}

	.blog-content li {
		margin-bottom: 0.75rem !important;
		color: #374151 !important;
		line-height: 1.7 !important;
		display: list-item !important;
		list-style-position: outside !important;
		padding-left: 0.5rem !important;
	}

	.blog-content ul ul,
	.blog-content ol ol,
	.blog-content ul ol,
	.blog-content ol ul {
		margin-top: 0.5rem;
		margin-bottom: 0.5rem;
	}

	/* Blockquotes */
	.blog-content blockquote {
		border-left: 4px solid #3b82f6;
		background: #f8fafc;
		padding: 1.5rem 2rem;
		margin: 2rem 0;
		border-radius: 0.5rem;
		font-style: italic;
		color: #475569;
	}

	.blog-content blockquote p {
		margin: 0;
		font-style: italic;
	}

	/* Strong and emphasis */
	.blog-content strong {
		font-weight: 700;
		color: #1e293b;
	}

	.blog-content em {
		font-style: italic;
	}

	/* Links */
	.blog-content a {
		color: #3b82f6;
		text-decoration: underline;
		text-underline-offset: 2px;
		transition: color 0.2s ease;
	}

	.blog-content a:hover {
		color: #1d4ed8;
	}

	/* Code */
	.blog-content code {
		background: #f1f5f9;
		color: #e11d48;
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
		font-size: 0.9em;
		font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
		border: 1px solid #e2e8f0;
	}

	.blog-content pre {
		background: #1e293b;
		color: #e2e8f0;
		padding: 1.5rem;
		border-radius: 0.75rem;
		margin: 2rem 0;
		overflow-x: auto;
		border: 1px solid #334155;
	}

	.blog-content pre code {
		background: transparent;
		color: inherit;
		padding: 0;
		border: none;
		font-size: 0.875rem;
	}

	/* Horizontal rules */
	.blog-content hr {
		border: none;
		height: 2px;
		background: #e5e7eb;
		margin: 3rem 0;
	}

	/* Tables */
	.blog-content table {
		width: 100%;
		border-collapse: collapse;
		margin: 2rem 0;
		background: white;
		border-radius: 0.5rem;
		overflow: hidden;
		box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
	}

	.blog-content th {
		background: #3b82f6;
		color: white;
		padding: 0.75rem 1rem;
		text-align: left;
		font-weight: 600;
	}

	.blog-content td {
		padding: 0.75rem 1rem;
		border-bottom: 1px solid #e5e7eb;
		color: #374151;
	}

	.blog-content tr:last-child td {
		border-bottom: none;
	}

	.blog-content tr:hover {
		background: #f8fafc;
	}

	/* Images */
	.blog-content img {
		max-width: 100%;
		height: auto;
		border-radius: 0.5rem;
		margin: 2rem 0;
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	}

	/* Footnotes */
	.blog-content section[data-footnotes],
	.blog-content .footnotes {
		margin-top: 3rem;
		padding-top: 2rem;
		border-top: 2px solid #e5e7eb;
	}

	.blog-content section[data-footnotes] h2,
	.blog-content .footnotes h2 {
		font-size: 1.25rem;
		margin-bottom: 1rem;
	}

	.blog-content section[data-footnotes] ol,
	.blog-content .footnotes ol {
		list-style-type: decimal;
	}

	.blog-content section[data-footnotes] li,
	.blog-content .footnotes li {
		margin-bottom: 0.5rem;
		font-size: 0.95rem;
	}

	/* Hide the auto-generated Footnotes heading if it's screen-reader only */
	.blog-content h2#footnote-label.sr-only,
	.blog-content section.footnotes h2.sr-only {
		display: none !important;
	}

	/* Responsive adjustments */
	@media (max-width: 768px) {
		.blog-content {
			font-size: 1rem;
		}
		
		.blog-content h1 {
			font-size: 2rem;
		}
		
		.blog-content h2 {
			font-size: 1.75rem;
		}
		
		.blog-content h3 {
			font-size: 1.375rem;
		}
		
		.blog-content h4 {
			font-size: 1.125rem;
		}

		.blog-content blockquote {
			padding: 1rem 1.5rem;
		}

		.blog-content pre {
			padding: 1rem;
			font-size: 0.8125rem;
		}
	}
</style>
