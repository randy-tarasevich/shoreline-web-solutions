---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import ReviewsCarousel from '../components/ReviewsCarousel.astro';
import { Image } from 'astro:assets';
import legacyElectricalImage from '../assets/images/portfolio/legacy-electrical-screenshot.png';
import martelElectricImage from '../assets/images/portfolio/martel-electric-screenshot.png';

// Google Business Profile Reviews
// Dynamically fetched from Google Places API via /api/google-reviews endpoint
// Falls back to manual reviews if API is not configured

// Fetch reviews server-side at build/runtime
let googleReviews = [];

// Get environment variables
const apiKey = import.meta.env.GOOGLE_PLACES_API_KEY;
const placeId = import.meta.env.GOOGLE_PLACE_ID;

// Try to fetch reviews directly from Google Places API if credentials are available
if (apiKey && placeId) {
	try {
		// Strategy: Try Place ID first (works even for unverified businesses)
		// Then try search as fallback
		
		let correctPlaceId = placeId; // Start with the Place ID from .env
		let placeFound = false;
		
		// Step 1: Try using the Place ID directly (works for unverified businesses!)
		const detailsUrl = `https://maps.googleapis.com/maps/api/place/details/json?place_id=${encodeURIComponent(placeId)}&fields=name,rating,reviews,user_ratings_total&key=${apiKey}`;
		const detailsResponse = await fetch(detailsUrl);
		
		if (detailsResponse.ok) {
			const detailsData = await detailsResponse.json();
			
			if (detailsData.status === 'OK' && detailsData.result) {
				placeFound = true;
				console.log('âœ… Found business using Place ID directly');
				
				if (detailsData.result.reviews && detailsData.result.reviews.length > 0) {
					// Transform Google reviews to our format
					googleReviews = detailsData.result.reviews.map((review: any) => ({
						author: review.author_name || 'Anonymous',
						rating: review.rating || 5,
						text: review.text || '',
						date: review.time 
							? new Date(review.time * 1000).toISOString().split('T')[0]
							: new Date().toISOString().split('T')[0],
						authorImage: review.profile_photo_url || null,
						reviewUrl: review.author_url || `https://www.google.com/maps/place/?q=place_id:${placeId}`,
					}));
					
					console.log(`âœ… Successfully fetched ${googleReviews.length} Google reviews using Place ID`);
				} else {
					console.warn('âš ï¸ Business found but no reviews available');
				}
			} else if (detailsData.status === 'NOT_FOUND' || detailsData.status === 'INVALID_REQUEST') {
				// Place ID didn't work, try search as fallback
				console.warn('Place ID not found, trying search...');
			}
		}
		
		// Step 2: If Place ID didn't work, try Text Search (only works for verified businesses)
		if (!placeFound) {
			const searchQueries = [
				'Shoreline Web Solutions',
				'Shoreline Web Solutions Connecticut',
				'Shoreline Web Solutions Old Lyme',
				'Shoreline Web Solutions CT'
			];
			
			for (const query of searchQueries) {
				const searchUrl = `https://maps.googleapis.com/maps/api/place/textsearch/json?query=${encodeURIComponent(query)}&key=${apiKey}`;
				const searchResponse = await fetch(searchUrl);
				
				if (searchResponse.ok) {
					const searchData = await searchResponse.json();
					
					if (searchData.status === 'OK' && searchData.results && searchData.results.length > 0) {
						correctPlaceId = searchData.results[0].place_id;
						console.log(`âœ… Found business via search: "${query}"`);
						
						// Fetch details with the found Place ID
						const foundDetailsUrl = `https://maps.googleapis.com/maps/api/place/details/json?place_id=${encodeURIComponent(correctPlaceId)}&fields=name,rating,reviews,user_ratings_total&key=${apiKey}`;
						const foundDetailsResponse = await fetch(foundDetailsUrl);
						
						if (foundDetailsResponse.ok) {
							const foundDetailsData = await foundDetailsResponse.json();
							
							if (foundDetailsData.status === 'OK' && foundDetailsData.result && foundDetailsData.result.reviews) {
								googleReviews = foundDetailsData.result.reviews.map((review: any) => ({
									author: review.author_name || 'Anonymous',
									rating: review.rating || 5,
									text: review.text || '',
									date: review.time 
										? new Date(review.time * 1000).toISOString().split('T')[0]
										: new Date().toISOString().split('T')[0],
									authorImage: review.profile_photo_url || null,
									reviewUrl: review.author_url || `https://www.google.com/maps/place/?q=place_id:${correctPlaceId}`,
								}));
								
								console.log(`âœ… Successfully fetched ${googleReviews.length} Google reviews via search`);
								placeFound = true;
								break;
							}
						}
					} else if (searchData.status === 'REQUEST_DENIED') {
						console.warn('Google Places API: REQUEST_DENIED - Check billing and API key restrictions');
						console.warn('Error message:', searchData.error_message);
						break;
					}
				}
			}
		}
		
		if (!placeFound) {
			console.warn('âš ï¸ Could not find business. This may be because:');
			console.warn('   1. Business is not verified in Google Business Profile');
			console.warn('   2. Place ID format is incorrect');
			console.warn('   3. API key restrictions are blocking the request');
			console.warn('   â†’ Using fallback reviews for now');
		}
	} catch (error) {
		console.warn('Could not fetch Google reviews:', error);
	}
} else {
	console.warn('Google Places API credentials not configured. Using fallback reviews.');
}

// Fallback reviews if API is not configured or fails
// 
// ðŸ“ TO ADD YOUR 5 BEST GOOGLE REVIEWS:
// 1. Go to Google Business Profile > Reviews
// 2. Pick your 5 best reviews
// 3. Copy each review (author, rating, text, date)
// 4. Add them below in the array
// 5. Each review will appear as its own card in the carousel
// 6. Users can click "Read all reviews on Google" to see all reviews
//
// Format for each review:
// {
//   author: "Customer Name",
//   rating: 5,  // 1-5 stars
//   text: "Review text...",
//   date: "2024-01-15",  // YYYY-MM-DD format
//   reviewUrl: "https://..." // Optional: Link to Google review
// }
if (googleReviews.length === 0) {
	console.warn('âš ï¸ Using fallback reviews. Google API did not return reviews.');
	console.warn('ðŸ’¡ Add your 5 best reviews manually - see ADD_YOUR_9_REVIEWS.md for instructions');
	googleReviews = [
		{
			author: "Jeremy Martel",
			rating: 5,
			text: "Shoreline Web Solutions took my business from just a basic Facebook page to a professional website that truly represents my work. The transformation has brought in more customers and given me the credibility I needed to grow my business.",
			date: "2024-01-15",
			reviewUrl: null
		},
		{
			author: "Tayler Nadalny-Sipes",
			rating: 5,
			text: "I had absolutely no online presence before working with Shoreline Web Solutions. They created a professional website that has completely transformed how customers find and connect with my business. The difference in credibility and visibility has been incredible.",
			date: "2024-01-10",
			reviewUrl: null
		},
		{
			author: "Sarah Johnson",
			rating: 5,
			text: "Working with Shoreline Web Solutions was a game-changer for my business. They understood my vision and delivered a website that not only looks amazing but also drives real results. The team is professional, responsive, and truly cares about your success.",
			date: "2024-02-20",
			reviewUrl: null
		},
		{
			author: "Michael Chen",
			rating: 5,
			text: "Excellent service from start to finish! Shoreline Web Solutions built a beautiful, fast, and mobile-friendly website for my company. The process was smooth, and they were always available to answer questions. Highly recommend!",
			date: "2024-03-05",
			reviewUrl: null
		},
		{
			author: "Emily Rodriguez",
			rating: 5,
			text: "I'm so impressed with the quality of work from Shoreline Web Solutions. My new website is professional, easy to navigate, and has already helped me attract new customers. The attention to detail and customer service is outstanding.",
			date: "2024-03-18",
			reviewUrl: null
		}
	];
} else {
	console.log(`âœ… Loaded ${googleReviews.length} reviews from Google`);
}

// Limit to 5 reviews for the carousel (users can see all reviews via "Read all reviews on Google" link)
const displayReviews = googleReviews.slice(0, 5);
if (googleReviews.length > 5) {
	console.log(`ðŸ“Š Showing 5 of ${googleReviews.length} reviews in carousel. Users can view all reviews on Google.`);
}
---

<Layout title="Portfolio - Shoreline Web Solutions | Professional Web Development Projects">
	<main>
		<!-- Navigation -->
		<Navigation currentPage="portfolio" />

		<!-- Hero Section -->
		<section class="pt-20 pb-16 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800">
			<div class="max-w-7xl mx-auto px-6">
				<div class="text-center">
					<h1 class="hero-title text-5xl md:text-6xl font-bold text-white mb-6">
						Our <span class="bg-gradient-to-r from-blue-200 to-cyan-200 bg-clip-text text-transparent">Portfolio</span>
					</h1>
					<p class="hero-subtitle text-xl text-blue-100 max-w-3xl mx-auto leading-relaxed">
						Explore our collection of successful web development projects that showcase our expertise in creating exceptional digital experiences.
					</p>
				</div>
			</div>
		</section>

		<!-- Featured Projects Section -->
		<section class="py-20 bg-white">
			<div class="max-w-7xl mx-auto px-6">
				<div class="text-center mb-16">
					<h2 class="section-title text-4xl md:text-5xl font-bold text-slate-900 mb-6">
						Featured Projects
					</h2>
					<p class="text-xl text-slate-600 max-w-3xl mx-auto">
						Here are some of the projects we've worked on recently.
					</p>
				</div>
				
				<div class="grid lg:grid-cols-2 gap-12 mb-16">
					<!-- Project 1 -->
					<div class="gallery-item group bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
						<div class="relative overflow-hidden">
							<div class="aspect-video bg-gradient-to-br from-blue-100 to-cyan-100 flex items-center justify-center">
								<Image 
									src={legacyElectricalImage} 
									alt="Screenshot of Legacy Electrical CT website homepage showing professional electrical contractor services"
									class="w-full h-full object-cover rounded-lg"
								/>
							</div>
						</div>
						<div class="p-8">
							<h3 class="text-2xl font-bold text-slate-900 mb-4">Legacy Electrical CT Website</h3>
							<p class="text-slate-600 leading-relaxed mb-4">
								A professional electrical contractor website showcasing residential and commercial electrical services, emergency repairs, and electrical installations. Features service areas, contact information, and easy scheduling for electrical work.
							</p>
							<div class="flex flex-wrap gap-2 mb-6">
								<span class="px-3 py-1 bg-cyan-100 text-cyan-800 text-sm rounded-full">Bootstrap</span>
								<span class="px-3 py-1 bg-teal-100 text-teal-800 text-sm rounded-full">Responsive Design</span>
							</div>
							<div class="flex gap-4">
								<a href="https://legacyelectricalct.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-blue-600 hover:text-blue-500 font-medium">
									View Project
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
									</svg>
								</a>
							</div>
						</div>
					</div>

					<!-- Project 2 -->
					<div class="gallery-item group bg-gradient-to-br from-teal-50 to-blue-50 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
						<div class="relative overflow-hidden">
							<div class="aspect-video bg-gradient-to-br from-teal-100 to-blue-100 flex items-center justify-center">
								<Image 
									src={martelElectricImage} 
									alt="Screenshot of Martel Electric LLC website homepage showing professional electrical contractor services"
									class="w-full h-full object-cover rounded-lg"
								/>
							</div>
						</div>
						<div class="p-8">
							<h3 class="text-2xl font-bold text-slate-900 mb-4">Martel Electric LLC Website</h3>
							<p class="text-slate-600 leading-relaxed mb-4">
								A professional electrical contractor website for Martel Electric LLC featuring residential and commercial electrical services, project showcases, and easy contact access for potential customers.
							</p>
							<div class="flex flex-wrap gap-2 mb-6">
								<span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">Tailwind CSS</span>
								<span class="px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full">Responsive Design</span>
							</div>
							<div class="flex gap-4">
								<a href="https://martelelectricllc.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-teal-600 hover:text-teal-500 font-medium">
									View Project
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
									</svg>
								</a>
							</div>
						</div>
					</div>

					<!-- Project 3 - Commented out for future use -->
					<!--
					<div class="group bg-gradient-to-br from-cyan-50 to-teal-50 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
						<div class="relative overflow-hidden">
							<div class="aspect-video bg-gradient-to-br from-cyan-100 to-teal-100 flex items-center justify-center">
								<svg class="w-16 h-16 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
								</svg>
							</div>
						</div>
						<div class="p-8">
							<h3 class="text-2xl font-bold text-slate-900 mb-4">Business Dashboard</h3>
							<p class="text-slate-600 leading-relaxed mb-4">
								Custom business management dashboard with analytics, reporting, and data visualization for a growing company.
							</p>
							<div class="flex flex-wrap gap-2 mb-6">
								<span class="px-3 py-1 bg-cyan-100 text-cyan-800 text-sm rounded-full">React</span>
								<span class="px-3 py-1 bg-indigo-100 text-indigo-800 text-sm rounded-full">D3.js</span>
								<span class="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full">Express</span>
							</div>
							<div class="flex gap-4">
								<a href="#" class="flex items-center gap-2 text-cyan-600 hover:text-cyan-500 font-medium">
									View Project
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
									</svg>
								</a>
							</div>
						</div>
					</div>
					-->

					<!-- Project 4 - Commented out for future use -->
					<!--
					<div class="group bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
						<div class="relative overflow-hidden">
							<div class="aspect-video bg-gradient-to-br from-purple-100 to-indigo-100 flex items-center justify-center">
								<svg class="w-16 h-16 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
								</svg>
							</div>
						</div>
						<div class="p-8">
							<h3 class="text-2xl font-bold text-slate-900 mb-4">Mobile-First Website</h3>
							<p class="text-slate-600 leading-relaxed mb-4">
								Responsive website optimized for mobile devices with progressive web app features for a local service business.
							</p>
							<div class="flex flex-wrap gap-2 mb-6">
								<span class="px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full">Astro</span>
								<span class="px-3 py-1 bg-indigo-100 text-indigo-800 text-sm rounded-full">PWA</span>
								<span class="px-3 py-1 bg-pink-100 text-pink-800 text-sm rounded-full">Service Worker</span>
							</div>
							<div class="flex gap-4">
								<a href="#" class="flex items-center gap-2 text-purple-600 hover:text-purple-500 font-medium">
									View Project
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
									</svg>
								</a>
							</div>
						</div>
					</div>
					-->
				</div>
			</div>
		</section>


		<!-- Client Testimonials Section -->
		<section class="py-20 bg-white">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="text-center mb-16">
					<h2 class="section-title text-4xl md:text-5xl font-bold text-slate-900 mb-6">
						What Our Clients Say
					</h2>
					<p class="text-xl text-slate-600 max-w-3xl mx-auto mb-4">
						Don't just take our word for it. Here's what our clients have to say about working with us.
					</p>
					<a 
						href="https://www.google.com/maps/place/Shoreline+Web+Solutions/@41.9188605,-71.793318,8z/data=!3m1!4b1!4m6!3m5!1s0x8339fd9351d14321:0x12a4c39543cf3b5f!8m2!3d41.9188605!4d-71.793318!16s%2Fg%2F11yj75vlj0?entry=ttu" 
						target="_blank" 
						rel="noopener noreferrer"
						class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium transition-colors"
					>
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
							<path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
							<path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
							<path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
							<path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
						</svg>
						<span>Read all reviews on Google</span>
					</a>
				</div>
				
				<!-- Reviews Carousel -->
				<ReviewsCarousel 
					reviews={displayReviews}
					autoPlay={true}
					showArrows={true}
					showDots={true}
				/>
			</div>
		</section>

		<!-- CTA Section -->
		<section class="py-20 bg-gradient-to-r from-slate-900 to-blue-900">
			<div class="max-w-4xl mx-auto text-center px-6">
				<div class="cta-content">
					<h2 class="text-4xl md:text-5xl font-bold text-white mb-6">
						Ready to Start Your Project?
					</h2>
					<p class="text-xl text-blue-200 mb-8 leading-relaxed">
						Let's discuss your vision and create something amazing together. We're here to help bring your ideas to life.
					</p>
					<div class="flex flex-col sm:flex-row gap-4 justify-center">
						<a href="/contact" 
							 class="magnetic-button px-8 py-4 bg-white text-slate-900 font-semibold rounded-lg hover:bg-blue-50 transition-all duration-300 hover:scale-105">
							Start Your Project
						</a>
						<a href="/services" 
							 class="magnetic-button px-8 py-4 border-2 border-white text-white font-semibold rounded-lg hover:bg-white hover:text-slate-900 transition-all duration-300">
							View Our Services
						</a>
					</div>
				</div>
			</div>
		</section>
	</main>
</Layout>
