---
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';
import Footer from '../components/Footer.astro';

export interface Props {
	title?: string;
	description?: string;
	keywords?: string;
	canonical?: string;
	ogImage?: string;
	ogType?: string;
	noindex?: boolean;
}

const { 
	title = "Shoreline Web Solutions - Professional Web Development in Old Lyme, CT",
	description = "Professional web development services in Old Lyme, Connecticut. Custom websites, performance optimization, and mobile-first design for businesses along the Connecticut shoreline.",
	keywords = "web development, Old Lyme CT, Connecticut web developer, responsive design, custom websites",
	canonical = Astro.url.href,
	ogImage = "https://shorelinewebsolutions.com/og-image.jpg",
	ogType = "website",
	noindex = false
} = Astro.props;

const siteUrl = "https://shorelinewebsolutions.com";
const fullCanonical = canonical.startsWith('http') ? canonical : `${siteUrl}${canonical}`;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		
		{noindex && <meta name="robots" content="noindex, nofollow" />}
		{!noindex && <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />}
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<meta name="author" content="Shoreline Web Solutions" />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={fullCanonical} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content={ogType} />
		<meta property="og:url" content={fullCanonical} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={ogImage} />
		<meta property="og:site_name" content="Shoreline Web Solutions" />
		<meta property="og:locale" content="en_US" />
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={fullCanonical} />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={ogImage} />
		
		<!-- Sitemap -->
		<link rel="sitemap" type="application/xml" href="/sitemap.xml" />
		
		<!-- View Transitions -->
		<ViewTransitions />
		
		<!-- Mobile-specific optimizations -->
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="format-detection" content="telephone=no" />
		
		<!-- Force CSS refresh on mobile -->
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		
	</head>
	<body class="antialiased">
		<!-- Structured Data (JSON-LD) -->
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": "LocalBusiness",
			"name": "Shoreline Web Solutions",
			"description": "Professional web development services in Old Lyme, Connecticut. Custom websites, performance optimization, and mobile-first design for businesses along the Connecticut shoreline.",
			"url": "https://shorelinewebsolutions.com",
			"logo": "https://shorelinewebsolutions.com/favicon.svg",
			"image": "https://shorelinewebsolutions.com/og-image.jpg",
			"address": {
				"@type": "PostalAddress",
				"addressLocality": "Old Lyme",
				"addressRegion": "CT",
				"addressCountry": "US"
			},
			"areaServed": {
				"@type": "State",
				"name": "Connecticut"
			},
			"priceRange": "$$",
			"telephone": "+1-860-XXX-XXXX"
		})} />
		
		<slot />
		
		<!-- Footer -->
		<Footer />
		
		<script>
			function initAnimations() {
				const observerOptions = {
					threshold: 0.2,
					rootMargin: '0px 0px -100px 0px'
				};

				const observer = new IntersectionObserver((entries) => {
					entries.forEach((entry, index) => {
						if (entry.isIntersecting) {
							// Staggered animation for feature cards
							if (entry.target.classList.contains('feature-card')) {
								setTimeout(() => {
									entry.target.classList.add('animate');
								}, index * 200);
							} 
							// Staggered animation for gallery items
							else if (entry.target.classList.contains('gallery-item')) {
								setTimeout(() => {
									entry.target.classList.add('animate');
								}, index * 150);
							}
							// Regular animations
							else {
								entry.target.classList.add('animate');
							}
						}
					});
				}, observerOptions);

				// Observe section titles
				document.querySelectorAll('.section-title').forEach(el => observer.observe(el));

				// Observe feature cards
				document.querySelectorAll('.feature-card').forEach(el => observer.observe(el));

				// Observe gallery items
				document.querySelectorAll('.gallery-item').forEach(el => observer.observe(el));

				// Observe blog cards
				document.querySelectorAll('.blog-card').forEach(el => observer.observe(el));

				// Observe content sections
				document.querySelectorAll('.content-text, .content-visual, .cta-content').forEach(el => {
					observer.observe(el);
				});
			}

			// Magnetic effect for CTA button
			function initMagneticButton() {
				const button = document.querySelector('.magnetic-button') as HTMLElement;
				if (button) {
					button.addEventListener('mousemove', function(e: MouseEvent) {
						const rect = this.getBoundingClientRect();
						const x = e.clientX - rect.left - rect.width / 2;
						const y = e.clientY - rect.top - rect.height / 2;
						
						this.style.transform = `translateY(-5px) scale(1.05) translate(${x * 0.1}px, ${y * 0.1}px)`;
					});

					button.addEventListener('mouseleave', function() {
						this.style.transform = 'translateY(-5px) scale(1.05) translate(0px, 0px)';
					});
				}
			}

			// Smooth scrolling for navigation links
			function initSmoothScrolling() {
				document.querySelectorAll('a[href^="#"]').forEach(anchor => {
					anchor.addEventListener('click', function (this: HTMLAnchorElement, e: Event) {
						e.preventDefault();
						const target = document.querySelector(this.getAttribute('href') || '');
						if (target) {
							target.scrollIntoView({
								behavior: 'smooth',
								block: 'start'
							});
						}
					});
				});
			}

			// Initialize on page load
			document.addEventListener('DOMContentLoaded', () => {
				initAnimations();
				initMagneticButton();
				initSmoothScrolling();
			});
			
			// Re-initialize after Astro page transitions
			document.addEventListener('astro:page-load', () => {
				initAnimations();
				initMagneticButton();
				initSmoothScrolling();
			});
		</script>
	</body>
</html>