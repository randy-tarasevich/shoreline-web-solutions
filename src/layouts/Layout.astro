---
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';
import Footer from '../components/Footer.astro';

export interface Props {
	title?: string;
	description?: string;
	keywords?: string;
	canonical?: string;
	ogImage?: string;
	ogType?: string;
	noindex?: boolean;
}

const { 
	title = "Shoreline Web Solutions - Professional Web Development Services",
	description = "Professional web development services for businesses. Custom websites, performance optimization, and mobile-first design that drive results.",
	keywords = "web development, web developer, responsive design, custom websites, web services",
	canonical = Astro.url.href,
	// TODO: Create a proper 1200x630px OG image at public/og-image.jpg
	// For now, using favicon as fallback - replace with actual OG image
	ogImage = "https://shorelinewebsolutions.com/og-image.jpg",
	ogType = "website",
	noindex = false
} = Astro.props;

const siteUrl = "https://shorelinewebsolutions.com";
const fullCanonical = canonical.startsWith('http') ? canonical : `${siteUrl}${canonical}`;
---

<!doctype html>
<html lang="en">
	<head>
		<!-- Google tag (gtag.js) -->
		{(() => {
			const gaId = import.meta.env.PUBLIC_GA_ID || 'G-ECJEXG46XH'; // Fallback for backward compatibility
			if (!gaId) return null;
			const scriptContent = `window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '${gaId}');`;
			return (
				<>
					<script async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
					<script is:inline set:html={scriptContent}></script>
				</>
			);
		})()}
		
		<!-- Security Headers (meta tags - Note: X-Frame-Options must be set at server/CDN level, not in meta tags) -->
		<meta http-equiv="X-Content-Type-Options" content="nosniff" />
		<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
		<meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), speaker=()" />
		
		<!-- Note: X-Frame-Options and other security headers must be set at server/CDN level -->
		<!-- See SECURITY_HEADERS.md for configuration instructions -->
		
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		
		{noindex && <meta name="robots" content="noindex, nofollow" />}
		{!noindex && <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />}
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<meta name="author" content="Shoreline Web Solutions" />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={fullCanonical} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content={ogType} />
		<meta property="og:url" content={fullCanonical} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={ogImage} />
		<meta property="og:site_name" content="Shoreline Web Solutions" />
		<meta property="og:locale" content="en_US" />
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={fullCanonical} />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={ogImage} />
		
		<!-- Sitemap -->
		<link rel="sitemap" type="application/xml" href="/sitemap.xml" />
		
		<!-- RSS Feed -->
		<link rel="alternate" type="application/rss+xml" title="Shoreline Web Solutions Blog RSS Feed" href="/rss.xml" />
		
		<!-- View Transitions -->
		<ViewTransitions />
		
		<!-- Mobile-specific optimizations -->
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="format-detection" content="telephone=no" />
		
	</head>
	<body class="antialiased">
		<!-- Skip to main content link for accessibility -->
		<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-blue-600 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
			Skip to main content
		</a>
		
		<!-- Structured Data (JSON-LD) -->
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": "LocalBusiness",
			"name": "Shoreline Web Solutions",
			"description": description,
			"url": "https://shorelinewebsolutions.com",
			"logo": "https://shorelinewebsolutions.com/favicon.svg",
			"image": "https://shorelinewebsolutions.com/og-image.jpg",
			"priceRange": "$$",
			"email": "info@shorelinewebsolutions.com",
			"address": {
				"@type": "PostalAddress",
				"addressLocality": "Old Lyme",
				"addressRegion": "CT",
				"addressCountry": "US"
			},
			"areaServed": {
				"@type": "State",
				"name": "Connecticut"
			},
			"sameAs": [
				"https://shorelinewebsolutions.com"
			]
		})} />
		
		<main id="main-content">
			<slot />
		</main>
		
		<!-- Footer -->
		<Footer />
		
		<script>
			import { initAllAnimations } from '../scripts/animations';

			// Initialize on page load
			document.addEventListener('DOMContentLoaded', () => {
				initAllAnimations();
			});
			
			// Re-initialize after Astro page transitions
			document.addEventListener('astro:page-load', () => {
				initAllAnimations();
			});
		</script>
	</body>
</html>