---
// EcommerceMockup.astro
// Animated e-commerce store interface mockup
// Shows a product listing with shopping cart and animated elements

// Generate unique ID for this instance
const storeId = `store-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="ecommerce-interface w-full h-full bg-white rounded-lg overflow-hidden flex flex-col shadow-sm">
    <!-- Store Header -->
    <div class="store-header h-12 bg-gradient-to-r from-teal-600 to-blue-600 text-white flex items-center justify-between px-4 flex-shrink-0">
        <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-white/20 rounded flex items-center justify-center text-xs">üõçÔ∏è</div>
            <h3 class="text-sm font-semibold m-0">Shop</h3>
        </div>
        <div class="flex items-center gap-2">
            <div class="relative">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <span id={`${storeId}-cartCount`} class="absolute -top-1 -right-1 w-4 h-4 bg-white text-teal-600 rounded-full text-[10px] flex items-center justify-center font-bold">0</span>
            </div>
        </div>
    </div>
    
    <!-- Store Content -->
    <div class="flex-1 p-3 bg-gray-50 overflow-hidden">
        <!-- Products Grid -->
        <div id={`${storeId}-products`} class="grid grid-cols-2 gap-2">
            <!-- Products will be added here -->
        </div>
    </div>
</div>

<style>
    .ecommerce-interface {
        min-height: 100%;
    }
    
    .product-card {
        animation: fadeInScale 0.4s forwards;
        opacity: 0;
    }
    
    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    .cart-badge {
        animation: bounce 0.5s;
    }
    
    @keyframes bounce {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.3);
        }
    }
</style>

<script define:vars={{ storeId }}>
    const products = [
        { name: 'Wireless Headphones', price: 79, image: 'üéß' },
        { name: 'Smart Watch', price: 199, image: '‚åö' },
        { name: 'Laptop Stand', price: 45, image: 'üíª' },
        { name: 'USB-C Cable', price: 15, image: 'üîå' }
    ];

    function initStore() {
        const productsContainer = document.getElementById(`${storeId}-products`);
        const cartCountEl = document.getElementById(`${storeId}-cartCount`);

        if (!productsContainer || !cartCountEl) {
            console.warn('Store elements not found:', storeId);
            return;
        }

        let cartCount = 0;
        let productIndex = 0;

        function addProduct(product, delay) {
            setTimeout(() => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white rounded-lg p-2 shadow-sm';
                productCard.innerHTML = `
                    <div class="w-full h-16 bg-gradient-to-br from-teal-100 to-blue-100 rounded flex items-center justify-center text-2xl mb-2">
                        ${product.image}
                    </div>
                    <div class="text-xs font-semibold text-gray-800 mb-1 line-clamp-1">${product.name}</div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-bold text-teal-600">$${product.price}</span>
                        <button class="add-to-cart w-6 h-6 bg-teal-600 text-white rounded text-xs flex items-center justify-center hover:bg-teal-700 transition-colors" data-price="${product.price}">
                            +
                        </button>
                    </div>
                `;
                
                productsContainer.appendChild(productCard);

                // Add click handler for add to cart button
                const addBtn = productCard.querySelector('.add-to-cart');
                if (addBtn) {
                    addBtn.addEventListener('click', () => {
                        cartCount++;
                        cartCountEl.textContent = cartCount;
                        cartCountEl.classList.add('cart-badge');
                        setTimeout(() => {
                            cartCountEl.classList.remove('cart-badge');
                        }, 500);
                    });
                }
            }, delay);
        }

        function showProducts() {
            productsContainer.innerHTML = '';
            productIndex = 0;
            cartCount = 0;
            cartCountEl.textContent = '0';

            products.forEach((product, index) => {
                addProduct(product, index * 400);
            });

            // Loop the animation
            setTimeout(() => {
                showProducts();
            }, products.length * 400 + 3000);
        }

        // Start showing products
        setTimeout(showProducts, 500);
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initStore);
    } else {
        setTimeout(initStore, 100);
    }
</script>

